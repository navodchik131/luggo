# üöÄ Luggo Production Deployment

## –ü–æ–ª–Ω–æ–µ –ø–µ—Ä–µ—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å –Ω—É–ª—è

### ‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï!
–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç **–ü–û–õ–ù–û–°–¢–¨–Æ –£–î–ê–õ–Ø–ï–¢** —Å—Ç–∞—Ä—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É –∏ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é. 
–í—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏—è—Ö.

## üìã –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ:
- ‚úÖ Ubuntu 20.04+ 
- ‚úÖ Node.js 18+
- ‚úÖ PostgreSQL 12+
- ‚úÖ Nginx
- ‚úÖ PM2
- ‚úÖ Git

## üöÄ –ó–∞–ø—É—Å–∫ –¥–µ–ø–ª–æ—è

### 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É:
```bash
ssh root@147.45.213.104
```

### 2. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –¥–µ–ø–ª–æ–π —Å–∫—Ä–∏–ø—Ç–∞:
```bash
cd /tmp
wget https://raw.githubusercontent.com/navodchik131/luggo/main/deploy/deploy.sh
chmod +x deploy.sh
```

### 3. –ó–∞–ø—É—Å–∫ –¥–µ–ø–ª–æ—è:
```bash
./deploy.sh
```

### 4. –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:
```bash
cd /home/luggo/luggo/backend
nano .env
```

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∑–∞–º–µ–Ω–∏—Ç–µ:**
- `TELEGRAM_BOT_TOKEN` - –ø–æ–ª—É—á–∏—Ç–µ –æ—Ç [@BotFather](https://t.me/BotFather)
- `YOOKASSA_SHOP_ID` –∏ `YOOKASSA_SECRET_KEY` - –∏–∑ –ø–∞–Ω–µ–ª–∏ –ÆKassa
- `EMAIL_USER` –∏ `EMAIL_PASS` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ—á—Ç—ã

### 5. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
```bash
pm2 restart luggo-backend
```

## üìä –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –¥–µ–ø–ª–æ–µ:

### üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞:
1. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö PM2 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
2. –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –ë–î –∏ —Ñ–∞–π–ª–æ–≤
3. –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
4. –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–¥–∞

### üîß –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
1. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –ë–î `luggo_prod` —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º `luggo_user`
2. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≤–µ–∂–µ–≥–æ –∫–æ–¥–∞ –∏–∑ GitHub
3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π –∏ JWT —Å–µ–∫—Ä–µ—Ç–æ–≤
5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
6. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ PM2

### ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç:
- üåê –°–∞–π—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ https://luggo.ru
- üîê –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ë–î
- ü§ñ –ì–æ—Ç–æ–≤—ã–π –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Telegram –±–æ—Ç
- üí∞ –ì–æ—Ç–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ÆKassa
- üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ PM2
- üöÄ –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:

### –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤:
```bash
pm2 status
sudo systemctl status nginx
```

### –õ–æ–≥–∏:
```bash
pm2 logs luggo-backend
tail -f /var/log/nginx/luggo_access.log
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API:
```bash
curl https://luggo.ru/api/subscription/plans
```

## üÜò –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏:

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:

```bash
# –ù–∞–π—Ç–∏ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏
ls -la /home/luggo/backups/

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ë–î
cd /home/luggo/backups/YYYYMMDD_HHMMSS/
sudo -u postgres psql luggo_prod < luggo_backup.sql

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª—ã
cp -r luggo_old /home/luggo/luggo
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. `pm2 logs luggo-backend` - –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. `sudo nginx -t` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è nginx
3. `sudo systemctl status postgresql` - —Å—Ç–∞—Ç—É—Å –ë–î

## üîß –¢–æ–Ω–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (Let's Encrypt):
```bash
sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d luggo.ru -d www.luggo.ru
```

### –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞:
```bash
sudo crontab -e
# –î–æ–±–∞–≤–∏—Ç—å: 0 12 * * * /usr/bin/certbot renew --quiet
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∞–π—Ä–≤–æ–ª–∞:
```bash
sudo ufw allow 22    # SSH
sudo ufw allow 80    # HTTP
sudo ufw allow 443   # HTTPS
sudo ufw enable
``` 